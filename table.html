<!DOCTYPE html>
<html lang="en">

<head>
    <title>Table V01</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--===============================================================================================-->
    <link rel="icon" type="image/png" href="images/icons/favicon.ico" />
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/perfect-scrollbar/perfect-scrollbar.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="css/util.css">
    <link rel="stylesheet" type="text/css" href="css/table.css">
    <!--===============================================================================================-->

    <script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-firestore.js"></script>


</head>

<body>





    <div class="limiter">
        <div class="container-table100">
            <div class="wrap-table100">
                <div class="table100">
                    <table id="resultTab">
                        <thead>
                            <tr class="table100-head">
                                <th class="column">Cadet ID</th>
                                <th class="column">Month/Year</th>
                                <th class="column">Arm Bending</th>
                                <th class="column">Pushups</th>
                                <th class="column">Rope Climbing</th>
                                <th class="column">Sit n Reach</th>
                                <th class="column">Shuttle Run</th>
                                <th class="column">Situps</th>
                                <th class="column">Standing Board Jump</th>
                                <th class="column">2 Mile Run</th>
                                <th class="column">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr></tr>

                            <script>
                                var d = sessionStorage.getItem("d");
                                var t = sessionStorage.getItem("t");
                                var int = sessionStorage.getItem("int");
                                var date = new Date(d);
                                var month = date.getMonth() + 1;
                                var year = date.getFullYear();
                                var t1 = sessionStorage.getItem("t1");

                                console.log(date);
                                console.log(month);
                                console.log(year);
                                console.log(t);
                                console.log(int);
                                console.log(t1);

                                firebase.initializeApp({
                                    apiKey: "AIzaSyDwbvS5gMt-dAGIJJs_iuvxjfgSIsWsZW0",
                                    authDomain: "mvf2-e0e2e.firebaseapp.com",
                                    databaseURL: "https://mvf2-e0e2e.firebaseio.com",
                                    projectId: "mvf2-e0e2e",
                                    storageBucket: "mvf2-e0e2e.appspot.com",
                                    messagingSenderId: "845407842102",
                                    appId: "1:845407842102:web:c55bfab8f766b90c69cd97"
                                });

                                var db = firebase.firestore();
                                var k = 1;

                                var docRef = db.collection("cadet").where("intake", "==", int.toString()).where("troop", "==", t1.toString());

                                docRef.get().then(function(querySnapshot) {
                                        querySnapshot.forEach(function(doc) {
                                            console.log(doc.id, " => ", doc.data());

                                            var table = document.getElementById("resultTab");

                                            var row = table.insertRow(k);
                                            var cell1 = row.insertCell(0);
                                            var cell2 = row.insertCell(1);
                                            var cell3 = row.insertCell(2);
                                            var cell4 = row.insertCell(3);
                                            var cell5 = row.insertCell(4);
                                            var cell6 = row.insertCell(5);
                                            var cell7 = row.insertCell(6);
                                            var cell8 = row.insertCell(7);
                                            var cell9 = row.insertCell(8);
                                            var cell10 = row.insertCell(9);
                                            var cell11 = row.insertCell(10);

                                            cell1.innerHTML = doc.id;
                                            cell2.innerHTML = month + "/" + year;
                                            cell3.innerHTML = "";
                                            cell4.innerHTML = "";
                                            cell5.innerHTML = "";
                                            cell6.innerHTML = "";
                                            cell7.innerHTML = "";
                                            cell8.innerHTML = "";
                                            cell9.innerHTML = "";
                                            cell10.innerHTML = "";
                                            cell11.innerHTML = "";

                                            cell3.setAttribute('contentEditable', 'true');
                                            cell4.setAttribute('contentEditable', 'true');
                                            cell5.setAttribute('contentEditable', 'true');
                                            cell6.setAttribute('contentEditable', 'true');
                                            cell7.setAttribute('contentEditable', 'true');
                                            cell8.setAttribute('contentEditable', 'true');
                                            cell9.setAttribute('contentEditable', 'true');
                                            cell10.setAttribute('contentEditable', 'true');
                                            cell11.setAttribute('contentEditable', 'true');
                                        });
                                    })
                                    .catch(function(error) {
                                        console.log("Error getting documents: ", error);
                                    });

                            </script>


                        </tbody>
                    </table>
                </div>
            </div>
            <div class="btns">
                <button class="color-change"><a href="troophome.html">Go Back</a></button>
                <button class="color-change"><a id="click">Insert Data</a></button>
            </div>
        </div>
    </div>


    <script type="text/javascript">
        document.getElementById("click").onclick = function() {
            insertData()
        };

        function insertData() {

            var d = sessionStorage.getItem("d");
            var t = sessionStorage.getItem("t");
            var t1 = sessionStorage.getItem("t1");
            var int = sessionStorage.getItem("int");
            var date = new Date(d);
            var month = date.getMonth() + 1;
            var year = date.getFullYear();

            var n1 = document.getElementById("resultTab").rows.length - 1;


            var str = "";

            for (i = 1; i < n1; i++) {

                var serviceNum = document.getElementById("resultTab").rows[i].cells.item(0).innerHTML;
                var arm = document.getElementById("resultTab").rows[i].cells.item(2).innerHTML;
                var push = document.getElementById("resultTab").rows[i].cells.item(3).innerHTML;
                var rope = document.getElementById("resultTab").rows[i].cells.item(4).innerHTML;
                var snr = document.getElementById("resultTab").rows[i].cells.item(5).innerHTML;
                var shuttle = document.getElementById("resultTab").rows[i].cells.item(6).innerHTML;
                var sit = document.getElementById("resultTab").rows[i].cells.item(7).innerHTML;
                var stand = document.getElementById("resultTab").rows[i].cells.item(8).innerHTML;
                var mile = document.getElementById("resultTab").rows[i].cells.item(9).innerHTML;
                var tot = document.getElementById("resultTab").rows[i].cells.item(10).innerHTML;


                var docName = serviceNum + "_" + month + "_" + year;
                var tempDoc = int + "-" + t1 + "-" + month;

                /*db.collection('result').doc(docName.toString()).set({
                    serviceNum: serviceNum.toString(),
                    year: year.toString(),
                    month: month.toString(),
                    armBending: arm.toString(),
                    push_ups: push.toString(),
                    rpClimbing: rope.toString(),
                    aAndR: snr.toString(),
                    shtlRun: shuttle.toString(),
                    sit_ups: sit.toString(),
                    stbJump: stand.toString(),
                    total: tot.toString(),
                    twoMileRun: mile.toString()
                });*/
                
                db.collection('temp').doc(tempDoc.toString()).set({
                    intake: int.toString(),
                    troop: t1.toString(),
                    month: month.toString(),
                    year: year.toString(),
                    msg: ""
                });
                
                db.collection('temp').doc(tempDoc.toString()).collection('result').doc(serviceNum.toString()).set({
                    serviceNum: serviceNum.toString(),
                    armBending: arm.toString(),
                    push_ups: push.toString(),
                    rpClimbing: rope.toString(),
                    aAndR: snr.toString(),
                    shtlRun: shuttle.toString(),
                    sit_ups: sit.toString(),
                    stbJump: stand.toString(),
                    total: tot.toString(),
                    twoMileRun: mile.toString()
                })

            }


        }

    </script>






    <!--===============================================================================================-->
    <script src="vendor/jquery/jquery-3.2.1.min.js"></script>
    <!--===============================================================================================-->
    <script src="vendor/bootstrap/js/popper.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <!--===============================================================================================-->
    <script src="vendor/select2/select2.min.js"></script>
    <!--===============================================================================================-->
    <script src="js/main.js"></script>

</body>

</html>
